= render "shared/error_messages", :webgrouper_patient_case => @webgrouper_patient_case
= simple_form_for :system, :url => change_system_path, :remote => true do |f|
  %fieldset#system
    %legend= t("fieldsets.system")
    .sameline
      = f.input :active_grouper, 
                :as => :select, 
                :include_blank => false,
                :collection => (1..9),
                :label_method => lambda { |el| t "simple_form.options.system.active_grouper.ag#{el}" }
      = f.input :procedures_catalog,
                :disabled => true,
                :wrapper_html => { :class => "small_field" }
      = f.input :diagnoses_catalog,
                :disabled => true,
                :wrapper_html => { :class => "small_field" }
    = f.input :care_provider, 
              :as => :select,
              :include_blank => false,
              :collection => ["hospital", "birthing_center"],
              :label_method => lambda { |el| t "simple_form.options.system.care_provider.#{el}" }
    
= simple_form_for @webgrouper_patient_case, :url => :create_query, :method => :get do |f|
  %fieldset#stay.left
    %legend= t("fieldsets.stay")
    = f.input :entry_date, 
              :input_html => { :title => t("simple_form.tooltips.date"), :class => "date_picker calc_los" }
    = f.input :exit_date, 
              :input_html => { :title => t("simple_form.tooltips.date"), :class => "date_picker calc_los" }
    = f.input :leave_days, 
              :input_html => { :class => "calc_los" }
    = f.input :adm, 
              :as => :select, 
              :include_blank => false,
              :collection => ["11", "00", "06", "99"],
              :label_method => lambda { |el| t "simple_form.options.webgrouper_patient_case.adm.adm#{el}" }
    = f.input :sep, 
              :as => :select, 
              :include_blank => false,
              :collection => ["06","04","00","07","99"],
              :label_method => lambda { |el| t "simple_form.options.webgrouper_patient_case.sep.sep#{el}" }
    = f.input :los

  %fieldset#patient-data.right
    %legend= t("fieldsets.patient_data")
    = f.input :sex, 
              :collection => [:M , :W, :U], 
              :checked => :U, 
              :include_blank => false
    = f.input :birth_date, 
              :input_html => { :title => t("simple_form.tooltips.date"), :class => "date_picker" }
    .sameline
      = f.input :age
      = f.input :age_mode,
                :as => :select, 
                :collection => [:years, :days],
                :include_blank => false, 
                :input_html => { :onchange => "admWeightControl(80)"},
                :label => false
    = f.input :hmv
    #admWeight
      = f.input :adm_weight

  %fieldset#drg-proc.left
    %legend= t("fieldsets.diagnoses_procedures")
    #diagnoses
      = f.input :pdx, 
                :url => autocomplete_ICD_IcCode_webgrouper_patient_cases_path, 
                :as => :autocomplete
      = f.label "diagnoses"
      = render "shared/diagnoses", :max_count => 99, :patient_case => @webgrouper_patient_case
    .buttons
      = link_to_add_fields("bullet_toggle_plus.png", "diagnoses")
      = link_to_remove_fields("bullet_toggle_minus.png", "diagnoses")
      
    %p
    #procedures
      = f.label "procedures"
      = render "shared/procedures", :max_count => 100, :patient_case => @webgrouper_patient_case
    .buttons
      = link_to_add_fields("bullet_toggle_plus.png", "procedures")
      = link_to_remove_fields("bullet_toggle_minus.png", "procedures")
      
  = f.submit :class => "button positive"
= button_to t("helpers.submit.webgrouper_patient_case.clear_form"), 
            webgrouper_patient_cases_path, 
            :class => "button negative", 
            :method => :get
              
= render "shared/result" unless @result.nil? || @result.getGst.nil?