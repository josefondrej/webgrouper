= render "shared/error_messages", :webgrouper_patient_case => @webgrouper_patient_case 

= simple_form_for @webgrouper_patient_case, :url => :create_query, :method => :get do |f|

  %fieldset#system
    %legend= t("fieldsets.system")
    .sameline
      = f.label :active_grouper
      = collection_select :system, :SyID, System.all.reverse, :SyID, :SyName, {:selected => System.current_system.SyID}
      .small_field
        = f.label :procedures_catalog
        = text_field_tag :procedures_catalog, System.current_system.SyCatProcs, :disabled => true
    .sameline
      - selected = @webgrouper_patient_case.house || 1
      = f.input :house, 
                :as => :select, 
                :collection => [1,2],
                :selected => selected,
                :label_method => lambda { |el| t "simple_form.options.webgrouper_patient_case.house.house#{el.to_s}" }
    .small_field
      = f.label :diagnoses_catalog
      = text_field_tag :diagnoses_catalog, System.current_system.SyCatDiags, :disabled => true
    
  .on-row
    %fieldset#stay.left
      %legend= t("fieldsets.stay")
      = f.input :entry_date, 
                :input_html => { :title => t("simple_form.tooltips.date"), :class => "date_picker calc_los" }
      = f.input :exit_date, 
                :input_html => { :title => t("simple_form.tooltips.date"), :class => "date_picker calc_los" }
      = f.input :leave_days, 
                :input_html => { :class => "calc_los" }
      = f.input :adm, 
                :as => :select, 
                :include_blank => false,
                :collection => ["11", "00", "06", "99"],
                :label_method => lambda { |el| t "simple_form.options.webgrouper_patient_case.adm.adm#{el}" }
      = f.input :sep, 
                :as => :select, 
                :include_blank => false,
                :collection => ["06","04","00","07","99"],
                :label_method => lambda { |el| t "simple_form.options.webgrouper_patient_case.sep.sep#{el}" }
      = f.input :los
  
    %fieldset#patient-data.right
      %legend= t("fieldsets.patient_data")
      = f.input :sex, 
                :collection => [:M , :W, :U], 
                :checked => :U, 
                :include_blank => false
      = f.input :birth_date, 
                :input_html => { :title => t("simple_form.tooltips.date"), :class => "date_picker" }
      .sameline
        = f.input :age
        = f.input :age_mode,
                  :as => :select, 
                  :collection => [:years, :days],
                  :include_blank => false, 
                  :input_html => { :onchange => "admWeightControl(80)"},
                  :label => false
      = f.input :hmv
      #admWeight
        = f.input :adm_weight

  %fieldset#drg-proc
    %legend= t("fieldsets.diagnoses_procedures")
    :javascript
      set_diagnoses_buttons("#{escape_javascript(add_button('diagnoses'))}", "#{escape_javascript(remove_button('diagnoses'))}")
      set_procedures_buttons("#{escape_javascript(add_button('procedures'))}", "#{escape_javascript(remove_button('procedures'))}")
    #diagnoses
      = f.input :pdx, 
                :url => autocomplete_ICD_IcCode_webgrouper_patient_cases_path, 
                :as => :autocomplete
      = f.label "diagnoses"
      = render "shared/diagnoses", :patient_case => @webgrouper_patient_case
    %p
    #procedures
      = f.label "procedures"
      = render "shared/procedures", :patient_case => @webgrouper_patient_case
      
  = f.submit :class => "button positive"
= button_to t("helpers.submit.webgrouper_patient_case.clear_form"), 
            webgrouper_patient_cases_path, 
            :class => "button negative", 
            :method => :get
= button_to "Help", help_url, :class => 'button', :method => :get
              
= render "result/main" unless @result.nil? || @result.getGst.nil?
